<Page x:Class="BioSAK.Pages.VectorDesignerPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      mc:Ignorable="d" d:DesignHeight="700" d:DesignWidth="1100"
      Title="Vector Designer" Background="WhiteSmoke">

    <Page.Resources>
        <Style x:Key="SectionHeader" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#444"/>
            <Setter Property="Margin" Value="0,8,0,4"/>
        </Style>
        <Style x:Key="SmallButton" TargetType="Button">
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Background" Value="#FFF"/>
            <Setter Property="BorderBrush" Value="#CCC"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="12"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E3F2FD"/>
                    <Setter Property="BorderBrush" Value="#42A5F5"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.5"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="ActionButton" TargetType="Button">
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Background" Value="#1976D2"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#1565C0"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.5"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="DangerButton" TargetType="Button">
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Background" Value="#E53935"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="11"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#C62828"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="ConstructListItem" TargetType="ListBoxItem">
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#BBDEFB"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E3F2FD"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Page.Resources>

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="280"/>
        </Grid.ColumnDefinitions>

        <!-- ==================== LEFT PANEL ==================== -->
        <Border Grid.Column="0" Background="White" CornerRadius="6" BorderBrush="#DDD" BorderThickness="1" Margin="0,0,5,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0" Background="#1976D2" CornerRadius="6,6,0,0" Padding="10,8">
                    <TextBlock Text="🧬 Vector Designer" FontSize="15" FontWeight="Bold" Foreground="White"/>
                </Border>

                <StackPanel Grid.Row="1" Margin="8,6,8,0">
                    <TextBlock Text="VECTOR LIBRARY" Style="{StaticResource SectionHeader}"/>
                    <ComboBox x:Name="CategoryComboBox" Margin="0,2,0,4" SelectionChanged="CategoryComboBox_SelectionChanged" FontSize="12">
                        <ComboBoxItem Content="All Categories" IsSelected="True"/>
                    </ComboBox>
                    <Border BorderBrush="#DDD" BorderThickness="1" CornerRadius="3" MaxHeight="100">
                        <ListBox x:Name="VectorLibraryListBox" FontSize="11" BorderThickness="0">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Margin="2">
                                        <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="11"/>
                                        <TextBlock Text="{Binding Description}" FontSize="9.5" Foreground="#888" TextWrapping="Wrap"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Border>
                    <Button Content="📥 Load Selected Vector" Style="{StaticResource ActionButton}" Click="LoadVector_Click" Margin="0,4,0,0" HorizontalAlignment="Stretch"/>
                    <Button Content="📂 Import .gb File" Style="{StaticResource SmallButton}" Click="ImportGenBank_Click" Margin="0,2,0,0" HorizontalAlignment="Stretch"/>
                    <Expander Header="📖 How to get .gb files" FontSize="10" Foreground="#666" IsExpanded="False" Margin="0,4,0,0">
                        <Border Background="#F9F9F9" CornerRadius="3" Padding="6,4" Margin="0,2,0,0">
                            <TextBlock TextWrapping="Wrap" FontSize="9.5" Foreground="#555" LineHeight="15">
                                <Bold>R Script</Bold> — run download_vectors.R<LineBreak/>
                                <Bold>NCBI</Bold> — ncbi.nlm.nih.gov/nuccore → Send to → File → GenBank<LineBreak/>
                                <Bold>Addgene</Bold> — addgene.org/[ID]/ → Sequences → GenBank<LineBreak/>
                                <Bold>SnapGene</Bold> — snapgene.com/resources/plasmid-files
                            </TextBlock>
                        </Border>
                    </Expander>

                    <Separator Margin="0,6,0,2"/>
                    <TextBlock Text="ADD CUSTOM SEQUENCE" Style="{StaticResource SectionHeader}"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Name:" VerticalAlignment="Center" FontSize="11" Margin="0,0,4,0"/>
                        <TextBox x:Name="CustomNameTextBox" Grid.Column="1" FontSize="11" Padding="4,2" Margin="0,2"/>
                    </Grid>
                    <TextBox x:Name="CustomSequenceTextBox" Height="50" FontSize="10" FontFamily="Consolas"
                             AcceptsReturn="True" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" Margin="0,4,0,2"/>
                    <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                        <CheckBox x:Name="IsCircularCheckBox" Content="Circular" FontSize="11" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBlock x:Name="CustomSeqLengthText" Text="0 bp" FontSize="10" Foreground="#888" VerticalAlignment="Center"/>
                    </StackPanel>
                    <Expander Header="Flanking RE Sites" FontSize="11" IsExpanded="False" Margin="0,4,0,0">
                        <StackPanel Margin="0,4,0,0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition/>
                                    <RowDefinition/>
                                </Grid.RowDefinitions>
                                <TextBlock Text="5' RE:" Grid.Row="0" FontSize="11" VerticalAlignment="Center" Margin="0,0,4,2"/>
                                <ComboBox x:Name="Flank5ComboBox" Grid.Row="0" Grid.Column="1" FontSize="10" FontFamily="Consolas" Margin="0,0,0,2" IsEditable="True"/>
                                <TextBlock Text="3' RE:" Grid.Row="1" FontSize="11" VerticalAlignment="Center" Margin="0,0,4,2"/>
                                <ComboBox x:Name="Flank3ComboBox" Grid.Row="1" Grid.Column="1" FontSize="10" FontFamily="Consolas" Margin="0,0,0,2" IsEditable="True"/>
                            </Grid>
                        </StackPanel>
                    </Expander>
                    <Button Content="➕ Add Sequence" Style="{StaticResource ActionButton}" Click="AddCustomSequence_Click" Margin="0,4,0,0" HorizontalAlignment="Stretch"/>
                </StackPanel>

                <StackPanel Grid.Row="2" Margin="8,4,8,4">
                    <Separator Margin="0,4,0,4"/>
                    <TextBlock Text="WORKSPACE" Style="{StaticResource SectionHeader}"/>
                    <ListBox x:Name="ConstructListBox" SelectionChanged="ConstructListBox_SelectionChanged"
                             ItemContainerStyle="{StaticResource ConstructListItem}" BorderBrush="#DDD" BorderThickness="1"
                             MinHeight="50" MaxHeight="160" FontSize="11">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Summary}" FontSize="11" TextWrapping="Wrap"/>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </StackPanel>
                <StackPanel Grid.Row="3" Margin="8,0,8,8">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="↩ Undo" Style="{StaticResource SmallButton}" Click="Undo_Click"/>
                        <Button Content="📋 Clone" Style="{StaticResource SmallButton}" Click="CloneConstruct_Click"/>
                        <Button Content="🗑 Delete" Style="{StaticResource DangerButton}" Click="DeleteConstruct_Click"/>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ==================== CENTER PANEL ==================== -->
        <Border Grid.Column="1" Background="White" CornerRadius="6" BorderBrush="#DDD" BorderThickness="1" Margin="5,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Toolbar -->
                <Border Grid.Row="0" Background="#F5F5F5" CornerRadius="6,6,0,0" Padding="10,6">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock x:Name="VisualizationTitle" Text="Select a construct" FontSize="14" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <TextBlock x:Name="VisualizationInfo" Text="" FontSize="12" Foreground="#888" Margin="10,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <ToggleButton x:Name="CircularViewToggle" Content="⭕" Width="32" Height="28" FontSize="14" Margin="2"
                                          ToolTip="Circular / Linear" Click="CircularViewToggle_Click" Background="White" BorderBrush="#CCC" Cursor="Hand"/>
                            <Border Width="1" Background="#DDD" Margin="4,4"/>
                            <Button Style="{StaticResource SmallButton}" Click="ZoomIn_Click" Width="38" Height="28" ToolTip="Zoom In">
                                <TextBlock Text="+" FontSize="18" FontWeight="Bold" Foreground="#333" Margin="0,-4,0,0"/>
                            </Button>
                            <Button Style="{StaticResource SmallButton}" Click="ZoomOut_Click" Width="38" Height="28" ToolTip="Zoom Out">
                                <TextBlock Text="−" FontSize="18" FontWeight="Bold" Foreground="#333" Margin="0,-4,0,0"/>
                            </Button>
                            <Button Style="{StaticResource SmallButton}" Click="ResetView_Click" Height="28" Padding="6,2">
                                <TextBlock Text="1:1" FontSize="12" FontWeight="SemiBold" Foreground="#555"/>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Map Canvas -->
                <Border Grid.Row="1" ClipToBounds="True">
                    <ScrollViewer x:Name="CanvasScrollViewer" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" Background="#FAFAFA">
                        <Canvas x:Name="VisualizationCanvas" Background="Transparent" MinWidth="600" MinHeight="300"
                                MouseMove="Canvas_MouseMove" MouseLeftButtonDown="Canvas_MouseDown"
                                MouseLeftButtonUp="Canvas_MouseUp" MouseLeave="Canvas_MouseLeave"/>
                    </ScrollViewer>
                </Border>

                <!-- Sequence Viewer (shown on drag-select) -->
                <Border x:Name="SeqViewerBorder" Grid.Row="2" Background="#F8F8F0" BorderBrush="#DDD" 
                        BorderThickness="0,1,0,0" MaxHeight="160" Visibility="Collapsed">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <Border Background="#EEEEE0" Padding="8,3">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock x:Name="SeqViewerTitle" Text="Sequence" FontSize="11" FontWeight="SemiBold" Foreground="#555"/>
                                <Button Grid.Column="1" Content="✕" FontSize="10" Width="22" Height="20" 
                                        Padding="0" Background="Transparent" BorderThickness="0" Cursor="Hand"
                                        Click="CloseSeqViewer_Click"/>
                            </Grid>
                        </Border>
                        <ScrollViewer Grid.Row="1" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" Padding="6,4">
                            <StackPanel>
                                <TextBlock x:Name="SeqCutSiteLine" FontSize="10" FontFamily="Consolas" Foreground="Red" Margin="0,0,0,0"/>
                                <TextBlock x:Name="SeqViewerText" FontSize="11" FontFamily="Consolas" Foreground="#333" TextWrapping="NoWrap"/>
                                <TextBlock x:Name="SeqComplementText" FontSize="11" FontFamily="Consolas" Foreground="#888" TextWrapping="NoWrap"/>
                            </StackPanel>
                        </ScrollViewer>
                    </Grid>
                </Border>

                <!-- Status -->
                <Border Grid.Row="3" Background="#F5F5F5" CornerRadius="0,0,6,6" Padding="10,4">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock x:Name="StatusText" Text="Drag on map to view sequence. Ready." FontSize="11" Foreground="#666"/>
                        <TextBlock x:Name="PositionText" Grid.Column="1" FontSize="11" Foreground="#888" FontFamily="Consolas"/>
                    </Grid>
                </Border>
            </Grid>
        </Border>

        <!-- ==================== RIGHT PANEL ==================== -->
        <Border Grid.Column="2" Background="White" CornerRadius="6" BorderBrush="#DDD" BorderThickness="1" Margin="5,0,0,0">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="8">

                    <!-- Features -->
                    <TextBlock Text="FEATURES" Style="{StaticResource SectionHeader}"/>
                    <Border BorderBrush="#DDD" BorderThickness="1" CornerRadius="3" MaxHeight="140">
                        <ListBox x:Name="FeatureListBox" FontSize="11" BorderThickness="0" SelectionChanged="FeatureListBox_SelectionChanged">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Margin="2">
                                        <Border Width="12" Height="12" CornerRadius="2" Margin="0,0,6,0">
                                            <Border.Background>
                                                <SolidColorBrush Color="{Binding Color}"/>
                                            </Border.Background>
                                        </Border>
                                        <TextBlock FontSize="11">
                                        <Run Text="{Binding Name, Mode=OneWay}" FontWeight="SemiBold"/>
                                        <Run Text=" "/><Run Text="{Binding PositionDisplay, Mode=OneWay}" Foreground="#888" FontSize="9.5"/>
                                        </TextBlock>
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Border>
                    <Expander Header="Add Feature" FontSize="11" Margin="0,4,0,0" IsExpanded="False">
                        <StackPanel Margin="0,4,0,0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition/>
                                    <RowDefinition/>
                                    <RowDefinition/>
                                    <RowDefinition/>
                                </Grid.RowDefinitions>
                                <TextBlock Text="Name:" Grid.Row="0" FontSize="11" VerticalAlignment="Center" Margin="0,0,4,2"/>
                                <TextBox x:Name="FeatureNameTextBox" Grid.Row="0" Grid.Column="1" FontSize="11" Padding="3,1" Margin="0,0,0,2"/>
                                <TextBlock Text="Type:" Grid.Row="1" FontSize="11" VerticalAlignment="Center" Margin="0,0,4,2"/>
                                <ComboBox x:Name="FeatureTypeComboBox" Grid.Row="1" Grid.Column="1" FontSize="11" Margin="0,0,0,2"/>
                                <TextBlock Text="Pos:" Grid.Row="2" FontSize="11" VerticalAlignment="Center" Margin="0,0,4,2"/>
                                <StackPanel Grid.Row="2" Grid.Column="1" Orientation="Horizontal" Margin="0,0,0,2">
                                    <TextBox x:Name="FeatureStartTextBox" Width="55" FontSize="11" Padding="3,1"/>
                                    <TextBlock Text=" — " FontSize="11" VerticalAlignment="Center"/>
                                    <TextBox x:Name="FeatureEndTextBox" Width="55" FontSize="11" Padding="3,1"/>
                                </StackPanel>
                                <CheckBox x:Name="FeatureReverseCheckBox" Grid.Row="3" Grid.Column="1" Content="Reverse strand" FontSize="11" Margin="0,2,0,0"/>
                            </Grid>
                            <Button Content="Add Feature" Style="{StaticResource SmallButton}" Click="AddFeature_Click" Margin="0,4,0,0" HorizontalAlignment="Stretch"/>
                        </StackPanel>
                    </Expander>

                    <Separator Margin="0,6,0,4"/>

                    <!-- RE Digest -->
                    <TextBlock Text="✂️ RESTRICTION DIGEST" Style="{StaticResource SectionHeader}"/>
                    <TextBox x:Name="EnzymeSearchBox" FontSize="11" Padding="4,3" TextChanged="EnzymeSearchBox_TextChanged">
                        <TextBox.Style>
                            <Style TargetType="TextBox">
                                <Style.Triggers>
                                    <Trigger Property="Text" Value="">
                                        <Setter Property="Background">
                                            <Setter.Value>
                                                <VisualBrush AlignmentX="Left" AlignmentY="Center" Stretch="None">
                                                    <VisualBrush.Visual>
                                                        <TextBlock Text="  🔍 Search enzyme..." Foreground="#AAA" FontSize="11" Margin="2,0,0,0"/>
                                                    </VisualBrush.Visual>
                                                </VisualBrush>
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBox.Style>
                    </TextBox>
                    <Border BorderBrush="#DDD" BorderThickness="1" CornerRadius="3" MaxHeight="100" Margin="0,4,0,0">
                        <ListBox x:Name="EnzymeListBox" FontSize="10" BorderThickness="0" FontFamily="Consolas" SelectionChanged="EnzymeListBox_SelectionChanged">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding Name}" Width="65" FontWeight="SemiBold"/>
                                        <TextBlock Text="{Binding RecognitionSequence}" Foreground="#666"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Border>
                    <Border x:Name="EnzymeInfoBorder" Background="#F5F5F5" CornerRadius="3" Margin="0,4,0,0" Padding="6,4" Visibility="Collapsed">
                        <StackPanel>
                            <TextBlock x:Name="EnzymeInfoText" FontSize="10" TextWrapping="Wrap"/>
                            <TextBlock x:Name="CutSiteCountText" FontSize="10" Foreground="#1976D2" FontWeight="SemiBold" Margin="0,2,0,0"/>
                        </StackPanel>
                    </Border>
                    <Button x:Name="DigestButton" Content="✂️ Digest" Style="{StaticResource ActionButton}"
                            Click="Digest_Click" Margin="0,6,0,0" HorizontalAlignment="Stretch" IsEnabled="False"/>
                    <TextBlock x:Name="DigestResultText" FontSize="10" Foreground="#666" TextWrapping="Wrap" Margin="0,4,0,0"/>

                    <Separator Margin="0,6,0,4"/>

                    <!-- ===== CLONING WORKFLOW ===== -->
                    <TextBlock Text="🔬 CLONING" Style="{StaticResource SectionHeader}"/>

                    <TextBlock Text="Vector:" FontSize="10" Foreground="#555" Margin="0,2,0,0"/>
                    <ComboBox x:Name="CloningVectorComboBox" FontSize="10" Margin="0,2,0,4" SelectionChanged="CloningSelectionChanged">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Summary}" FontSize="10"/>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>

                    <TextBlock Text="Insert:" FontSize="10" Foreground="#555"/>
                    <ComboBox x:Name="CloningInsertComboBox" FontSize="10" Margin="0,2,0,4" SelectionChanged="CloningSelectionChanged">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Summary}" FontSize="10"/>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>

                    <!-- Orientation -->
                    <StackPanel Orientation="Horizontal" Margin="0,2,0,4">
                        <TextBlock Text="Orientation:" FontSize="10" Foreground="#555" VerticalAlignment="Center" Margin="0,0,6,0"/>
                        <RadioButton x:Name="ForwardRadio" Content="Forward (→)" FontSize="10" IsChecked="True" Margin="0,0,10,0" Checked="CloningSelectionChanged"/>
                        <RadioButton x:Name="ReverseRadio" Content="Reverse (←)" FontSize="10" Checked="CloningSelectionChanged"/>
                    </StackPanel>

                    <!-- RE site selection -->
                    <TextBlock Text="Cut sites (select or auto-detect):" FontSize="10" Foreground="#555" Margin="0,2,0,2"/>
                    <Border BorderBrush="#DDD" BorderThickness="1" CornerRadius="3" MaxHeight="100" Margin="0,0,0,4">
                        <ListBox x:Name="CloningREListBox" FontSize="10" FontFamily="Consolas" BorderThickness="0"
                                 SelectionMode="Single" SelectionChanged="CloningREListBox_SelectionChanged">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}" FontSize="10"/>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Border>

                    <TextBlock x:Name="CloningInfoText" FontSize="10" Foreground="#888" TextWrapping="Wrap" Margin="0,0,0,4"/>

                    <Button x:Name="CloningButton" Content="🧬 Clone Insert into Vector" Style="{StaticResource ActionButton}"
                            Click="Cloning_Click" Margin="0,2,0,0" HorizontalAlignment="Stretch" IsEnabled="False"/>
                    <TextBlock x:Name="CloningResultText" FontSize="10" Foreground="#666" TextWrapping="Wrap" Margin="0,4,0,0"/>

                    <Separator Margin="0,6,0,4"/>
                    <Button Content="📋 Copy Sequence" Style="{StaticResource SmallButton}" Click="CopySequence_Click" HorizontalAlignment="Stretch"/>
                </StackPanel>
            </ScrollViewer>
        </Border>
    </Grid>
</Page>
