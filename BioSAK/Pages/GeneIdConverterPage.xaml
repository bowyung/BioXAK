<Page x:Class="BioSAK.Pages.GeneIdConverterPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      mc:Ignorable="d" 
      d:DesignHeight="800" d:DesignWidth="1000"
      Title="Gene ID Converter"
      Background="#F5F5F5">

    <Page.Resources>
        <Style x:Key="SectionBorderStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Margin" Value="0,0,0,15"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.1"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="Background" Value="#2196F3"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                CornerRadius="4" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#1976D2"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Background" Value="#BDBDBD"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ExportButtonStyle" TargetType="Button" BasedOn="{StaticResource ActionButtonStyle}">
            <Setter Property="Background" Value="#4CAF50"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                CornerRadius="4" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#388E3C"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Background" Value="#BDBDBD"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DataGridStyle" TargetType="DataGrid">
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="IsReadOnly" Value="True"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="CanUserDeleteRows" Value="False"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="RowHeight" Value="28"/>
            <Setter Property="ColumnHeaderHeight" Value="32"/>
            <Setter Property="EnableRowVirtualization" Value="True"/>
            <Setter Property="EnableColumnVirtualization" Value="True"/>
            <Setter Property="VirtualizingPanel.IsVirtualizing" Value="True"/>
            <Setter Property="VirtualizingPanel.VirtualizationMode" Value="Recycling"/>
            <Setter Property="ScrollViewer.IsDeferredScrollingEnabled" Value="True"/>
            <!-- 單格選取設定 -->
            <Setter Property="SelectionMode" Value="Extended"/>
            <Setter Property="SelectionUnit" Value="CellOrRowHeader"/>
            <Setter Property="ClipboardCopyMode" Value="IncludeHeader"/>
        </Style>
    </Page.Resources>

    <Grid Margin="20">
        <!-- 進度條覆蓋層 -->
        <Grid x:Name="ProgressOverlay" Visibility="Collapsed" Panel.ZIndex="100">
            <Border Background="#80000000"/>
            <Border Background="White" CornerRadius="8" Padding="30" 
                    HorizontalAlignment="Center" VerticalAlignment="Center" MinWidth="300">
                <StackPanel>
                    <TextBlock x:Name="ProgressTitle" Text="Loading..." FontSize="16" FontWeight="SemiBold" Margin="0,0,0,15"/>
                    <ProgressBar x:Name="ProgressBar" Height="20" Minimum="0" Maximum="100" Value="0"/>
                    <TextBlock x:Name="ProgressText" Text="0%" HorizontalAlignment="Center" Margin="0,10,0,0" Foreground="#666"/>
                </StackPanel>
            </Border>
        </Grid>

        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- 標題 -->
                <TextBlock Text="🧬 Gene ID Converter" FontSize="24" FontWeight="Bold" 
                           Foreground="#1976D2" Margin="0,0,0,20"/>

                <!-- 設定區 -->
                <Border Style="{StaticResource SectionBorderStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- 物種選擇 -->
                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Species:" 
                                   FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,15,10"/>
                        <ComboBox x:Name="SpeciesComboBox" Grid.Row="0" Grid.Column="1" 
                                  Width="250" Height="32" HorizontalAlignment="Left" Margin="0,0,0,10"
                                  SelectionChanged="SpeciesComboBox_SelectionChanged">
                            <ComboBoxItem Content="Human (Homo sapiens)" Tag="human" IsSelected="True"/>
                            <ComboBoxItem Content="Mouse (Mus musculus)" Tag="mouse"/>
                            <ComboBoxItem Content="Rat (Rattus norvegicus)" Tag="rat"/>
                            <ComboBoxItem Content="Zebrafish (Danio rerio)" Tag="zebrafish"/>
                            <ComboBoxItem Content="Fly (D. melanogaster)" Tag="fly"/>
                            <ComboBoxItem Content="Worm (C. elegans)" Tag="worm"/>
                        </ComboBox>

                        <!-- 輸入類型 -->
                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Input Type:" 
                                   FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,15,10"/>
                        <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Margin="0,0,0,10">
                            <RadioButton x:Name="InputTypeAuto" Content="Auto Detect" IsChecked="True" Margin="0,0,20,0"/>
                            <RadioButton x:Name="InputTypeSymbol" Content="Symbol" Margin="0,0,20,0"/>
                            <RadioButton x:Name="InputTypeEnsembl" Content="Ensembl ID" Margin="0,0,20,0"/>
                            <RadioButton x:Name="InputTypeEntrez" Content="Entrez ID" Margin="0,0,20,0"/>
                            <RadioButton x:Name="InputTypeHGNC" Content="HGNC ID" Margin="0,0,0,0"/>
                        </StackPanel>

                        <!-- 提示訊息 -->
                        <TextBlock Grid.Row="2" Grid.Column="1" 
                                   Text="💡 Auto Detect: Symbol, Ensembl (ENSG...), Entrez (numbers), HGNC (HGNC:...)"
                                   Foreground="#666" FontSize="11" Margin="0,0,0,5"/>
                    </Grid>
                </Border>

                <!-- 輸入區 -->
                <Border Style="{StaticResource SectionBorderStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0">
                            <TextBlock Text="📝 Input Gene IDs (one per line, or comma/tab separated)" 
                                       FontWeight="SemiBold" Margin="0,0,0,10"/>
                            <TextBox x:Name="InputGenesTextBox" 
                                     Height="200" 
                                     AcceptsReturn="True" 
                                     TextWrapping="Wrap"
                                     VerticalScrollBarVisibility="Auto"
                                     FontFamily="Consolas"
                                     FontSize="12"
                                     Padding="8"/>
                            <TextBlock x:Name="InputCountText" Text="0 genes" 
                                       Foreground="#666" Margin="0,5,0,0" FontSize="11"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" VerticalAlignment="Top" Margin="20,25,0,0">
                            <Button Content="🔄 Convert" Style="{StaticResource ActionButtonStyle}" 
                                    Click="Convert_Click" Width="120"/>
                            <Button Content="📋 Paste" Style="{StaticResource ActionButtonStyle}" 
                                    Click="Paste_Click" Width="120" Margin="0,10,0,0" Background="#FF9800"/>
                            <Button Content="🗑️ Clear" Style="{StaticResource ActionButtonStyle}" 
                                    Click="Clear_Click" Width="120" Margin="0,10,0,0" Background="#757575"/>
                            <Button Content="📂 Load File" Style="{StaticResource ActionButtonStyle}" 
                                    Click="LoadFile_Click" Width="120" Margin="0,10,0,0" Background="#9C27B0"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- 結果區 -->
                <Border Style="{StaticResource SectionBorderStyle}">
                    <StackPanel>
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Orientation="Horizontal">
                                <TextBlock Text="📊 Conversion Results" FontWeight="SemiBold" 
                                           FontSize="14" VerticalAlignment="Center"/>
                                <TextBlock x:Name="ResultSummaryText" Text="" 
                                           Foreground="#666" Margin="15,0,0,0" VerticalAlignment="Center"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <Button Content="📄 Export CSV" Style="{StaticResource ExportButtonStyle}"
                                        Click="ExportCsv_Click"/>
                                <Button Content="📋 Copy All" Style="{StaticResource ExportButtonStyle}"
                                        Click="CopyAll_Click" Margin="10,0,0,0" Background="#FF5722"/>
                            </StackPanel>
                        </Grid>

                        <!-- 提示：如何複製 -->
                        <TextBlock Text="💡 Select cells and Ctrl+C to copy, or right-click for options"
                                   Foreground="#888" FontSize="11" Margin="0,0,0,8"/>

                        <DataGrid x:Name="ResultsDataGrid" 
                                  Style="{StaticResource DataGridStyle}"
                                  Height="350">
                            <DataGrid.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Copy Cell(s)" Click="CopyCell_Click" InputGestureText="Ctrl+C"/>
                                    <MenuItem Header="Copy Row(s)" Click="CopyRow_Click"/>
                                    <MenuItem Header="Copy Column" Click="CopyColumn_Click"/>
                                    <Separator/>
                                    <MenuItem Header="Copy All" Click="CopyAll_Click"/>
                                </ContextMenu>
                            </DataGrid.ContextMenu>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Input" Binding="{Binding Input}" Width="120"/>
                                <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="80"/>
                                <DataGridTextColumn Header="Symbol" Binding="{Binding Symbol}" Width="100"/>
                                <DataGridTextColumn Header="Ensembl ID" Binding="{Binding EnsemblId}" Width="180"/>
                                <DataGridTextColumn Header="Entrez ID" Binding="{Binding EntrezId}" Width="100"/>
                                <DataGridTextColumn Header="HGNC ID" Binding="{Binding HgncId}" Width="100"/>
                                <DataGridTextColumn Header="Full Name" Binding="{Binding FullName}" Width="250"/>
                                <DataGridTextColumn Header="Biotype" Binding="{Binding Biotype}" Width="120"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <!-- 未找到的基因 -->
                        <Expander x:Name="NotFoundExpander" Header="⚠️ Not Found" Margin="0,15,0,0" 
                                  Visibility="Collapsed">
                            <Border Background="#FFF3E0" CornerRadius="4" Padding="10" Margin="0,10,0,0">
                                <StackPanel>
                                    <TextBlock x:Name="NotFoundText" TextWrapping="Wrap" Foreground="#E65100"/>
                                    <Button Content="📋 Copy Not Found IDs" 
                                            Click="CopyNotFound_Click"
                                            HorizontalAlignment="Left" Margin="0,8,0,0"
                                            Padding="10,4" FontSize="11" Cursor="Hand"
                                            Background="#FF9800" Foreground="White" BorderThickness="0">
                                        <Button.Template>
                                            <ControlTemplate TargetType="Button">
                                                <Border x:Name="border" Background="{TemplateBinding Background}" 
                                                        CornerRadius="3" Padding="{TemplateBinding Padding}">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="border" Property="Background" Value="#F57C00"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Button.Template>
                                    </Button>
                                </StackPanel>
                            </Border>
                        </Expander>

                        <!-- 多重匹配的基因 -->
                        <Expander x:Name="MultiMatchExpander" Header="ℹ️ Multiple Matches" Margin="0,10,0,0"
                                  Visibility="Collapsed">
                            <Border Background="#E3F2FD" CornerRadius="4" Padding="10" Margin="0,10,0,0">
                                <TextBlock x:Name="MultiMatchText" TextWrapping="Wrap" Foreground="#1565C0"/>
                            </Border>
                        </Expander>
                    </StackPanel>
                </Border>

                <!-- 資料庫資訊 -->
                <Border Style="{StaticResource SectionBorderStyle}" Background="#FAFAFA">
                    <StackPanel>
                        <TextBlock Text="ℹ️ Database Information" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        <TextBlock x:Name="DatabaseInfoText" TextWrapping="Wrap" Foreground="#666" FontSize="12">
                            <Run Text="Data source: HGNC (Human), NCBI Gene (Other species)"/>
                            <LineBreak/>
                            <Run x:Name="DatabaseVersionText" Text="Version: Loading..."/>
                        </TextBlock>
                        <TextBlock x:Name="LastUpdateText" Text="" Foreground="#666" 
                                   Margin="0,5,0,0" FontSize="11"/>
                        <TextBlock x:Name="AvailableDbText" Text="" Foreground="#888" 
                                   Margin="0,5,0,0" FontSize="11"/>

                        <!-- 更新資料庫區塊 -->
                        <Border Background="#E3F2FD" CornerRadius="4" Padding="12" Margin="0,15,0,0">
                            <StackPanel>
                                <TextBlock Text="🔄 Update Database" FontWeight="SemiBold" Margin="0,0,0,8"/>
                                <TextBlock Text="Select species to download from HGNC/NCBI:" Foreground="#666" FontSize="11" Margin="0,0,0,8"/>
                                <WrapPanel Margin="0,0,0,10">
                                    <CheckBox x:Name="UpdateHumanCheck" Content="Human (HGNC)" IsChecked="True" Margin="0,0,15,5"/>
                                    <CheckBox x:Name="UpdateMouseCheck" Content="Mouse (NCBI)" IsChecked="True" Margin="0,0,15,5"/>
                                    <CheckBox x:Name="UpdateRatCheck" Content="Rat (NCBI)" IsChecked="True" Margin="0,0,15,5"/>
                                    <CheckBox x:Name="UpdateZebrafishCheck" Content="Zebrafish (NCBI)" Margin="0,0,15,5"/>
                                    <CheckBox x:Name="UpdateFlyCheck" Content="Fly (NCBI)" Margin="0,0,15,5"/>
                                    <CheckBox x:Name="UpdateWormCheck" Content="Worm (NCBI)" Margin="0,0,0,5"/>
                                </WrapPanel>
                                <StackPanel Orientation="Horizontal">
                                    <Button Content="⬇️ Download Selected" Style="{StaticResource ActionButtonStyle}"
                                            Click="UpdateDatabase_Click" Background="#1976D2" Padding="12,6"/>
                                    <TextBlock x:Name="UpdateStatusText" Text="" Foreground="#666" 
                                               VerticalAlignment="Center" Margin="15,0,0,0" FontSize="11"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
