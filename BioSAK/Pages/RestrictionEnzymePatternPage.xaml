<Page x:Class="BioSAK.Pages.RestrictionEnzymePatternPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:BioSAK.Pages"
      xmlns:controls="clr-namespace:BioSAK.Controls"
      mc:Ignorable="d" 
      d:DesignHeight="600" d:DesignWidth="900"
      Title="Restriction Enzyme Pattern Predictor"
      Background="WhiteSmoke">

    <Page.Resources>
        <Style x:Key="HeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,0,5"/>
        </Style>
        
        <Style x:Key="InputBorderStyle" TargetType="Border">
            <Setter Property="BorderBrush" Value="#CCCCCC"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="3"/>
            <Setter Property="Background" Value="White"/>
        </Style>
    </Page.Resources>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="350"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Title -->
        <TextBlock Grid.Row="0" Grid.ColumnSpan="2" 
                   Text="Restriction Enzyme Pattern Predictor" 
                   FontSize="20" 
                   FontWeight="Bold" 
                   Margin="0,0,0,15"/>

        <!-- Left Panel - Input -->
        <ScrollViewer Grid.Row="1" Grid.Column="0" 
                      VerticalScrollBarVisibility="Auto"
                      Margin="0,0,15,0">
            <StackPanel>
                <!-- Sequence Input -->
                <TextBlock Text="DNA Sequence:" Style="{StaticResource HeaderStyle}"/>
                <Border Style="{StaticResource InputBorderStyle}" Margin="0,0,0,10">
                    <TextBox x:Name="SequenceTextBox" 
                             Height="120" 
                             TextWrapping="Wrap" 
                             AcceptsReturn="True"
                             VerticalScrollBarVisibility="Auto"
                             FontFamily="Consolas"
                             BorderThickness="0"
                             Padding="5"/>
                </Border>

                <!-- Sequence Info -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                    <TextBlock Text="Length: "/>
                    <TextBlock x:Name="SequenceLengthText" Text="0 bp" FontWeight="SemiBold"/>
                </StackPanel>

                <!-- Topology Selection -->
                <TextBlock Text="Topology:" Style="{StaticResource HeaderStyle}"/>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                    <RadioButton x:Name="LinearRadio" 
                                 Content="Linear" 
                                 IsChecked="True" 
                                 Margin="0,0,20,0"/>
                    <RadioButton x:Name="CircularRadio" 
                                 Content="Circular"/>
                </StackPanel>

                <!-- Enzyme Selection -->
                <TextBlock Text="Select Enzyme:" Style="{StaticResource HeaderStyle}"/>
                <Border Style="{StaticResource InputBorderStyle}" Margin="0,0,0,5">
                    <TextBox x:Name="EnzymeSearchBox" 
                             BorderThickness="0"
                             Padding="5"
                             Text=""
                             TextChanged="EnzymeSearchBox_TextChanged">
                        <TextBox.Style>
                            <Style TargetType="TextBox">
                                <Style.Triggers>
                                    <Trigger Property="Text" Value="">
                                        <Setter Property="Background">
                                            <Setter.Value>
                                                <VisualBrush Stretch="None" AlignmentX="Left">
                                                    <VisualBrush.Visual>
                                                        <TextBlock Text="Search enzyme..." 
                                                                   Foreground="Gray" 
                                                                   Margin="5,0,0,0"/>
                                                    </VisualBrush.Visual>
                                                </VisualBrush>
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBox.Style>
                    </TextBox>
                </Border>
                
                <Border Style="{StaticResource InputBorderStyle}" Height="150" Margin="0,0,0,15">
                    <ListBox x:Name="EnzymeListBox" 
                             BorderThickness="0"
                             SelectionMode="Single"
                             SelectionChanged="EnzymeListBox_SelectionChanged">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding Name}" 
                                               FontWeight="SemiBold" 
                                               Width="80"/>
                                    <TextBlock Text="{Binding RecognitionSequence}" 
                                               FontFamily="Consolas"
                                               Foreground="Gray"/>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Border>

                <!-- Selected Enzyme Info -->
                <Border Background="#F0F0F0" 
                        CornerRadius="5" 
                        Padding="10" 
                        Margin="0,0,0,15"
                        Visibility="{Binding ElementName=SelectedEnzymePanel, Path=Visibility}">
                    <StackPanel x:Name="SelectedEnzymePanel" Visibility="Collapsed">
                        <TextBlock Text="Selected Enzyme:" FontWeight="SemiBold"/>
                        <TextBlock x:Name="SelectedEnzymeName" FontSize="16" Foreground="#0066CC"/>
                        <TextBlock x:Name="SelectedEnzymeInfo" Foreground="Gray" TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>

                <!-- Marker Type -->
                <TextBlock Text="Marker Type:" Style="{StaticResource HeaderStyle}"/>
                <ComboBox x:Name="MarkerTypeCombo" 
                          Margin="0,0,0,15"
                          SelectionChanged="MarkerTypeCombo_SelectionChanged">
                    <ComboBoxItem Content="Standard (10K-250bp)" IsSelected="True"/>
                    <ComboBoxItem Content="High Resolution (10K-100bp)"/>
                </ComboBox>

                <!-- Digest Button -->
                <Button x:Name="DigestButton" 
                        Content="Digest" 
                        Height="35" 
                        FontSize="14"
                        Background="#4CAF50"
                        Foreground="White"
                        BorderThickness="0"
                        Cursor="Hand"
                        Click="DigestButton_Click"/>

                <!-- Results Summary -->
                <Border Background="#E3F2FD" 
                        CornerRadius="5" 
                        Padding="10" 
                        Margin="0,15,0,0">
                    <StackPanel x:Name="ResultsPanel" Visibility="Collapsed">
                        <TextBlock Text="Digestion Results:" FontWeight="SemiBold"/>
                        <TextBlock x:Name="CutSitesText"/>
                        <TextBlock x:Name="FragmentsText" TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>

                <!-- Fragments Table -->
                <TextBlock Text="Fragments:" 
                           Style="{StaticResource HeaderStyle}" 
                           Margin="0,15,0,5"/>
                <Border Style="{StaticResource InputBorderStyle}" MaxHeight="200">
                    <DataGrid x:Name="FragmentsDataGrid"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              HeadersVisibility="Column"
                              GridLinesVisibility="Horizontal"
                              BorderThickness="0"
                              CanUserResizeRows="False">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Size (bp)" 
                                                Binding="{Binding Size}" 
                                                Width="80"/>
                            <DataGridTextColumn Header="Start" 
                                                Binding="{Binding StartPosition}" 
                                                Width="60"/>
                            <DataGridTextColumn Header="End" 
                                                Binding="{Binding EndPosition}" 
                                                Width="60"/>
                            <DataGridTextColumn Header="5' Enzyme" 
                                                Binding="{Binding Enzyme5End.Name}" 
                                                Width="80"/>
                            <DataGridTextColumn Header="3' Enzyme" 
                                                Binding="{Binding Enzyme3End.Name}" 
                                                Width="80"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- Right Panel - Gel Visualization -->
        <Border Grid.Row="1" Grid.Column="1" 
                Background="#1a1a2e" 
                CornerRadius="5"
                Padding="10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <TextBlock Grid.Row="0" 
                           Text="Gel Electrophoresis" 
                           Foreground="White" 
                           FontSize="14" 
                           FontWeight="SemiBold"
                           Margin="0,0,0,10"/>
                
                <controls:ElectrophoresisGelControl x:Name="GelControl" 
                                                    Grid.Row="1"/>
            </Grid>
        </Border>
    </Grid>
</Page>
