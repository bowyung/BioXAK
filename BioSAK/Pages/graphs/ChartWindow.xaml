<Window x:Class="BioSAK.ChartWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Chart" 
        Height="700" Width="900"
        MinHeight="500" MinWidth="600"
        WindowStartupLocation="CenterOwner"
        Background="#F5F5F5"
        KeyDown="Window_KeyDown"
        Focusable="True">

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Main Toolbar -->
        <Border Grid.Row="0" Background="White" CornerRadius="5" Padding="10" Margin="0,0,0,5">
            <StackPanel Orientation="Horizontal">
                <Button Content="💾 Save PNG" Padding="8,5" Margin="0,0,5,0"
                        Background="#4CAF50" Foreground="White" BorderThickness="0"
                        Cursor="Hand" Click="SaveAsPng_Click"/>
                <Button Content="💾 Save SVG" Padding="8,5" Margin="0,0,10,0"
                        Background="#2196F3" Foreground="White" BorderThickness="0"
                        Cursor="Hand" Click="SaveAsSvg_Click"/>
                <Separator Margin="5,0"/>
                <Button Content="📋 Copy to Clipboard" Padding="8,5" Margin="5,0"
                        Background="#9C27B0" Foreground="White" BorderThickness="0"
                        Cursor="Hand" Click="CopyToClipboard_Click" ToolTip="Ctrl+C"/>
                <Separator Margin="5,0"/>
                <Button Content="📊 Statistics" Padding="8,5" Margin="5,0"
                        Background="#FF5722" Foreground="White" BorderThickness="0"
                        Cursor="Hand" Click="OpenStatistics_Click"/>
                <Separator Margin="5,0"/>
                <TextBlock Text="Double-click chart to edit | Ctrl+A: Select All | Del: Delete" 
                           VerticalAlignment="Center" Foreground="#888" FontStyle="Italic" Margin="10,0"/>
            </StackPanel>
        </Border>

        <!-- Annotation Toolbar -->
        <Border Grid.Row="1" Background="White" CornerRadius="5" Padding="10" Margin="0,0,0,5">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Add:" VerticalAlignment="Center" Margin="0,0,10,0" FontWeight="SemiBold"/>

                <Button x:Name="TextBoxTool" Content="📝 Text" Padding="8,5" Margin="0,0,5,0"
                        Background="#FF9800" Foreground="White" BorderThickness="0"
                        Cursor="Hand" Click="AddTextBox_Click" ToolTip="Add Text Box"/>

                <Button Content="Ω Symbol" Padding="8,5" Margin="0,0,5,0"
                        Background="#9C27B0" Foreground="White" BorderThickness="0"
                        Cursor="Hand" Click="OpenSymbolPicker_Click" ToolTip="Insert Special Symbol"/>

                <Separator Margin="10,0"/>
                <TextBlock Text="Lines:" VerticalAlignment="Center" Margin="0,0,10,0" FontWeight="SemiBold"/>

                <Button Content="─" Padding="10,5" Margin="0,0,3,0"
                        Background="#607D8B" Foreground="White" BorderThickness="0"
                        Cursor="Hand" Click="AddLine_Click" ToolTip="Straight Line" Tag="Line"/>
                <Button Content="┌┐" Padding="10,5" Margin="0,0,3,0"
                        Background="#607D8B" Foreground="White" BorderThickness="0"
                        Cursor="Hand" Click="AddLine_Click" ToolTip="U-Shape (ㄇ)" Tag="UShape"/>
                <Button Content="→" Padding="10,5" Margin="0,0,3,0"
                        Background="#607D8B" Foreground="White" BorderThickness="0"
                        Cursor="Hand" Click="AddLine_Click" ToolTip="Arrow" Tag="Arrow"/>
                <Button Content="╠╣" Padding="10,5" Margin="0,0,3,0"
                        Background="#607D8B" Foreground="White" BorderThickness="0"
                        Cursor="Hand" Click="AddLine_Click" ToolTip="H-Shape" Tag="HShape"/>

                <Separator Margin="10,0"/>
                <Button Content="🗑 Delete (Del)" Padding="8,5"
                        Background="#EF5350" Foreground="White" BorderThickness="0"
                        Cursor="Hand" Click="DeleteSelected_Click"/>
            </StackPanel>
        </Border>

        <!-- Chart Area -->
        <Border Grid.Row="2" Background="White" CornerRadius="5" ClipToBounds="True">
            <Grid x:Name="ChartContainer">
                <Canvas x:Name="ChartCanvas" Background="White" 
                        MouseLeftButtonDown="ChartCanvas_MouseLeftButtonDown"
                        MouseMove="ChartCanvas_MouseMove"
                        MouseLeftButtonUp="ChartCanvas_MouseLeftButtonUp"
                        SizeChanged="ChartCanvas_SizeChanged"/>
                <!-- Selection Rectangle -->
                <Rectangle x:Name="SelectionRect" Stroke="#2196F3" StrokeThickness="1" 
                           StrokeDashArray="4 2" Fill="#202196F3" Visibility="Collapsed"/>
            </Grid>
        </Border>

        <!-- Legend -->
        <Border Grid.Row="3" Background="White" CornerRadius="5" Padding="10" Margin="0,5,0,0">
            <WrapPanel x:Name="LegendPanel" HorizontalAlignment="Center"/>
        </Border>
    </Grid>
</Window>
